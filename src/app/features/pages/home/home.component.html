<img src="./../../../../assets/images/sugestao-cardapio.png" alt="Sugestão de cardápio diário" class="sugestao-cardapio">
<div class="panel">
  <div class="panel-header">
    <p class="panel-title">
      {{ currentDate | date : "EEEE, dd/MM/yyyy" | capitalizeFirstLetter }}
      <img alt="Rango's WEEK logo" src="./../../../../assets/images/leaf-logo.png" class="img-leaf"/>
    </p>
  </div>
  <button
    pButton
    pRipple
    label="Adicionar alimento"
    icon="pi pi-plus"
    class="p-button-success add-alimento-button"
    (click)="openNew()"
  ></button>
  <div class="card">
    <p-toast></p-toast>
    <p-toolbar styleClass="mb-4 gap-2">
      <div class="tables-container" >
        <div class="table-wrapper" >
          <p-table [value]="cols" dataKey="field" >
            <ng-template pTemplate="header" >
              <tr>
                <th scope="col" style="width: 5rem"></th>
                <th scope="col" class="header-title">Refeições (Total kcal: {{ totalKcal }})</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-col let-expanded="expanded" let-i="rowIndex">
              <tr>
                <td>
                  <p-button
                    type="button"
                    pRipple
                    [pRowToggler]="col"
                    [text]="true"
                    [rounded]="true"
                    [plain]="true"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                  ></p-button>
                </td>
                <td class="header-subtitle">{{ col.header }} (Total kcal: {{ cols[i].totalKcal}})</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-col>
              <tr>
                <td colspan="2">
                  <div class="p-3">
                    <p-table [value]="col.details" dataKey="id" [tableStyle]="{ 'width': '100%' }">
                      <ng-template pTemplate="header">
                        <tr>
                          <th style="width: 4rem"></th>
                          <th scope="col" pSortableColumn="nome_alimento" style="min-width: 15rem">
                            Nome do Alimento
                            <p-sortIcon field="nome_alimento"></p-sortIcon>
                          </th>
                          <th scope="col" pSortableColumn="kcal">
                            Calorias (kcal) <p-sortIcon field="kcal"></p-sortIcon>
                          </th>
                          <th scope="col" pSortableColumn="quantidade" style="min-width: 10rem">
                            Quantidade (g)
                            <p-sortIcon field="quantidade"></p-sortIcon>
                          </th>
                          <th scope="col" pSortableColumn="nome_categoria" style="min-width: 10rem">
                            Categoria
                            <p-sortIcon field="nome_categoria"></p-sortIcon>
                          </th>
                          <th scope="col">
                            <button
                              pButton
                              pRipple
                              label="Adicionar alimento"
                              icon="pi pi-plus"
                              class="p-button-success mr-2"
                              (click)="openNew()"
                            ></button>
                          </th>
                          <th scope="col"></th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-detail>
                        <tr>
                          <td></td>
                          <td>{{ detail.nome_alimento }}</td>
                          <td>{{ detail.kcal }}</td>
                          <td>{{ detail.quantidade }}</td>
                          <td>{{ detail.nome_categoria }}</td>
                          <td>
                            <button
                              pButton
                              pRipple
                              icon="pi pi-pencil"
                              class="p-button-rounded p-button-success editDeleteButtons"
                              (click)="editAlimentoCardapio(detail)"
                            ></button>
                            <button
                              pButton
                              pRipple
                              icon="pi pi-trash"
                              class="p-button-rounded p-button-warning editDeleteButtons"
                              (click)="deleteAlimentoCardapio(detail)"
                            ></button>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </p-toolbar>
    <p-dialog
      [(visible)]="cardapioDialog"
      [style]="{ width: '60rem', height: '50rem' }"
      header="Detalhes do Alimento"
      [modal]="true"
      styleClass="p-fluid"
    >
      <ng-template pTemplate="content">
        <div class="formgrid grid">
          <div class="field col-12">
            <label for="nome_alimento" class="labelItem">Nome do alimento</label>
            <p-dropdown
              [options]="alimentoOptions"
              [(ngModel)]="selectedAlimento"
              optionLabel="nome_alimento"
              [filter]="true"
              filterBy="nome_alimento"
              [showClear]="true"
              placeholder="Selecione um alimento"
              appendTo="body"
              (onChange)="onAlimentoChange($event)"
            >
              <ng-template pTemplate="selectedItem" let-selectedOption>
                <div class="flex align-items-center gap-2">
                  <div>{{ selectedOption.nome_alimento }}</div>
                </div>
              </ng-template>
              <ng-template let-alimento pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <div>{{ alimento.nome_alimento }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
          <div class="field col-12">
            <label for="nome_refeicao" class="labelItem">Nome da Refeição</label>
            <p-dropdown
              [options]="refeicoes"
              [(ngModel)]="cardapio.nome_refeicao"
              optionLabel="label"
              placeholder="Selecione uma refeição"
              appendTo="body"
            ></p-dropdown>
          </div>
          <div class="field col-12">
            <label for="nome_categoria" class="labelItem">Categoria</label>
            <input
              id="nome_categoria"
              type="text"
              pInputText
              [(ngModel)]="cardapio.nome_categoria"
              [disabled]="true"
            />
          </div>
          <div class="field col-12">
            <label for="quantidade" class="labelItem">Quantidade (g)</label>
            <input
              id="quantidade"
              type="text"
              pInputText
              [(ngModel)]="cardapio.quantidade"
              [disabled]="true"
            />
          </div>
          <div class="field col-12">
            <label for="kcal" class="labelItem">Calorias (kcal)</label>
            <input
              id="kcal"
              type="number"
              pInputText
              [(ngModel)]="cardapio.kcal"
              [disabled]="true"
            />
          </div>
          <div class="field col-12">
            <label for="dia_semana" class="labelItem">Dia da Semana</label>
            <p-dropdown
              [options]="diasSemana"
              [(ngModel)]="cardapio.dia_semana"
              optionLabel="label"
              placeholder="Selecione um dia"
              appendTo="body"
            ></p-dropdown>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="footer">
        <p-button
          pRipple
          label="Cancelar"
          icon="pi pi-times"
          [text]="true"
          (click)="hideDialog()"
        ></p-button>
        <p-button
          (click)="saveAlimentoCardapio()"
          pRipple
          label="Salvar"
          icon="pi pi-check"
          [text]="true"
        ></p-button>
      </ng-template>
    </p-dialog>

    <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
  </div>
</div>